<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <title>Linktelligence DB</title>
  <style>
    table { border-collapse: collapse; margin-top: 1rem; }
    th, td { border: 1px solid #ccc; padding: 4px 8px; font-size: 13px; }
    form.inline { display: inline; }
  </style>
</head>
<body>
  {% with msgs = get_flashed_messages() %}
    {% if msgs %}
      <ul>
        {% for m in msgs %}<li>{{ m }}</li>{% endfor %}
      </ul>
    {% endif %}
  {% endwith %}

  <h1>Просмотр и управление таблицами</h1>

  <form method="get" action="/">
    <label>Таблица:
      <select name="table" onchange="this.form.submit()">
        {% for t in tables %}
          <option value="{{ t }}" {% if t == selected %}selected{% endif %}>{{ t }}</option>
        {% endfor %}
      </select>
    </label>
  </form>

  {% if selected %}
    <form class="inline" method="post" action="{{ url_for('drop_table') }}"
          onsubmit="return confirm('Удалить таблицу {{ selected }}?');">
      <input type="hidden" name="table" value="{{ selected }}">
      <button type="submit">Удалить таблицу</button>
    </form>

    <form class="inline" method="post" action="{{ url_for('import_json') }}" enctype="multipart/form-data">
      <input type="hidden" name="table" value="{{ selected }}">
      <input type="file" name="json_file" accept=".json">
      <button type="submit">Импорт JSON</button>
    </form>

    <h2>Содержимое {{ selected }}</h2>
    <table>
      <thead>
        <tr>
          {% for c in cols %}
            <th>{{ c }}</th>
          {% endfor %}
          <th>Действия</th>
        </tr>
      </thead>
      <tbody>
        {% for row in rows %}
          <tr>
            {% for c in cols %}
              <td>{{ row[c] }}</td>
            {% endfor %}
            <td>
              <!-- удаление строки -->
              <form class="inline" method="post" action="{{ url_for('delete_row') }}"
                    onsubmit="return confirm('Удалить id={{ row['id'] }}?');">
                <input type="hidden" name="table" value="{{ selected }}">
                <input type="hidden" name="row_id" value="{{ row['id'] }}">
                <button type="submit">Удалить</button>
              </form>

              <!-- простое редактирование ключевых полей -->
              <form class="inline" method="post" action="{{ url_for('edit_row') }}">
                <input type="hidden" name="table" value="{{ selected }}">
                <input type="hidden" name="row_id" value="{{ row['id'] }}">
                IP: <input name="node_ip" size="10" value="{{ row['node_ip'] }}">
                Тип: <input name="node_type" size="8" value="{{ row['node_type'] }}">
                Ports: <input name="open_port_count" size="3" value="{{ row['open_port_count'] }}">
                <button type="submit">Сохранить</button>
              </form>
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  {% endif %}
</body>
</html>
